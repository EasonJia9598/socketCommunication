
    <!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <!-- common.css -->
      <style>* {-webkit-tap-highlight-color: rgba(0,0,0,0);}html {-webkit-text-size-adjust: none;}body {font-family: -apple-system, Helvetica, Arial, sans-serif;margin: 0;padding: 20px;color: #333;word-wrap: break-word;}h1, h2, h3, h4, h5, h6 {line-height: 1.1;}img {max-width: 100% !important;height: auto;}blockquote {margin: 0;padding: 0 15px;color: #777;border-left: 4px solid #ddd;}hr {background-color: #ddd;border: 0;height: 1px;margin: 15px 0;}code {font-family: Menlo, Consolas, 'Ubuntu Mono', Monaco, 'source-code-pro', monospace;line-height: 1.4;margin: 0;padding: 0.2em 0;font-size: 90%;background-color: rgba(0,0,0,0.04);border-radius: 3px;}pre > code {margin: 0;padding: 0;font-size: 100%;word-break: normal;background: transparent;border: 0;}ol {list-style-type: decimal;}ol ol, ul ol {list-style-type: lower-latin;}ol ol ol, ul ol ol, ul ul ol, ol ul ol {list-style-type: lower-roman;}table {border-spacing: 0;border-collapse: collapse;margin-top: 0;margin-bottom: 16px;}table th {font-weight: bold;}table th, table td {padding: 6px 13px;border: 1px solid #ddd;}table tr {border-top: 1px solid #ccc;}table tr:nth-child(even) {background-color: #f8f8f8;}input[type="checkbox"] {cursor: default;margin-right: 0.5em;font-size: 13px;}.task-list-item {list-style-type: none;}.task-list-item+.task-list-item {margin-top: 3px;}.task-list-item input {float: left;margin: 0.3em 1em 0.25em -1.6em;vertical-align: middle;}#tag-field {margin: 8px 2px 10px;}#tag-field .tag {display: inline-block;background: #cadff3;border-radius: 4px;padding: 1px 8px;color: black;font-size: 12px;margin-right: 10px;line-height: 1.4;}</style>
      <!-- ace-static.css -->
      <style>.ace_static_highlight {white-space: pre-wrap;}.ace_static_highlight .ace_gutter {width: 2em;text-align: right;padding: 0 3px 0 0;margin-right: 3px;}.ace_static_highlight.ace_show_gutter > .ace_line {padding-left: 2.6em;}.ace_static_highlight .ace_line {position: relative;}.ace_static_highlight .ace_gutter-cell {-moz-user-select: -moz-none;-khtml-user-select: none;-webkit-user-select: none;user-select: none;top: 0;bottom: 0;left: 0;position: absolute;}.ace_static_highlight .ace_gutter-cell:before {content: counter(ace_line, decimal);counter-increment: ace_line;}.ace_static_highlight {counter-reset: ace_line;}</style>
      <style>.ace-monokai .ace_gutter {background: #2F3129;color: #8F908A}.ace-monokai .ace_print-margin {width: 1px;background: #555651}.ace-monokai {background-color: #272822;color: #F8F8F2}.ace-monokai .ace_cursor {color: #F8F8F0}.ace-monokai .ace_marker-layer .ace_selection {background: #49483E}.ace-monokai.ace_multiselect .ace_selection.ace_start {box-shadow: 0 0 3px 0px #272822;}.ace-monokai .ace_marker-layer .ace_step {background: rgb(102, 82, 0)}.ace-monokai .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid #49483E}.ace-monokai .ace_marker-layer .ace_active-line {background: #202020}.ace-monokai .ace_gutter-active-line {background-color: #272727}.ace-monokai .ace_marker-layer .ace_selected-word {border: 1px solid #49483E}.ace-monokai .ace_invisible {color: #52524d}.ace-monokai .ace_entity.ace_name.ace_tag,.ace-monokai .ace_keyword,.ace-monokai .ace_meta.ace_tag,.ace-monokai .ace_storage {color: #F92672}.ace-monokai .ace_punctuation,.ace-monokai .ace_punctuation.ace_tag {color: #fff}.ace-monokai .ace_constant.ace_character,.ace-monokai .ace_constant.ace_language,.ace-monokai .ace_constant.ace_numeric,.ace-monokai .ace_constant.ace_other {color: #AE81FF}.ace-monokai .ace_invalid {color: #F8F8F0;background-color: #F92672}.ace-monokai .ace_invalid.ace_deprecated {color: #F8F8F0;background-color: #AE81FF}.ace-monokai .ace_support.ace_constant,.ace-monokai .ace_support.ace_function {color: #66D9EF}.ace-monokai .ace_fold {background-color: #A6E22E;border-color: #F8F8F2}.ace-monokai .ace_storage.ace_type,.ace-monokai .ace_support.ace_class,.ace-monokai .ace_support.ace_type {font-style: italic;color: #66D9EF}.ace-monokai .ace_entity.ace_name.ace_function,.ace-monokai .ace_entity.ace_other,.ace-monokai .ace_entity.ace_other.ace_attribute-name,.ace-monokai .ace_variable {color: #A6E22E}.ace-monokai .ace_variable.ace_parameter {font-style: italic;color: #FD971F}.ace-monokai .ace_string {color: #E6DB74}.ace-monokai .ace_comment {color: #75715E}.ace-monokai .ace_indent-guide {background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAEklEQVQImWPQ0FD0ZXBzd/wPAAjVAoxeSgNeAAAAAElFTkSuQmCC) right repeat-y}</style>
      <!-- export.css -->
      <style>
        body{margin:0 auto;max-width:800px;line-height:1.4}
        #nav{margin:5px 0 10px;font-size:15px}
        #titlearea{border-bottom:1px solid #ccc;font-size:17px;padding:10px 0;}
        #contentarea{font-size:15px;margin:16px 0}
        .cell{outline:0;min-height:20px;margin:5px 0;padding:5px 0;}
        .code-cell{font-family:Menlo,Consolas,'Ubuntu Mono',Monaco,'source-code-pro',monospace;font-size:12px;}
        .latex-cell{white-space:pre-wrap;}
      </style>
      <!-- User CSS -->
      <style> .text-cell {font-size: 15px;}.code-cell {font-size: 12px;}.markdown-cell {font-size: 15px;}.latex-cell {font-size: 15px;}</style>
    </head>
    <body>
      <div id="nav"><div>Up: <a href='index.html'>Index</a></div></div>
      <div id="titlearea">
        <h2>Report of Pipes' assignment </h2>
      </div>
      <div id="contentarea"><div class="cell markdown-cell"><h1>This is a fully report of  -- AS 1 Pipes' communication.</h1>
<blockquote>
<p>By Zesheng Jia - A00416452</p>
</blockquote>
</div><div class="cell markdown-cell"><h2>Quick brief :</h2>
<blockquote>
<p>In assignment 1, your task is to implement distributed median finding algorithm using pipes. The parent process spawns K (5) identical child processes along with 2*K (10) pipes - two for each parent-child pair (one sends messages from parent→child, the other sends messages from child→parent). Each child reads an array of 5 integers. The numbers are read from 5 files (one for each child process). The files are named as "input_1.txt", "input_2.txt", ... , "input_5.txt". Various stages of the algorithm (reproduced from the assignment[1]) is given below:</p>
</blockquote>
</div><div class="cell markdown-cell"><p>In my version of finding median between 5 input files, I used 2 programs by exec family funcitons.<br>
One is the main program for parent process which invokes 5 children processes,control messages sending and decide when will be the correct ouput by k == m.<br>
The other one is the external program for calculating information and sending calculated messages to parent process.<br>
Message sending includes that array content, array size, pivot , count of numbers that small than pivot and count of numbers that larger than pivot.<br>
Operations on variables includes that delete every number small than pivot, delete every larger number than pivot.</p>
</div><div class="cell diagram-cell"><svg height="392" version="1.1" width="762.5625" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="overflow: hidden; position: relative; left: -0.5px; top: -0.34375px;"><desc>Created with Raphaël 2.1.2</desc><defs><path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block"></path><marker id="raphael-marker-endblock55-obj1276" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5"><use NS1:href="#raphael-marker-block" transform="rotate(180 2.5 2.5) scale(1,1)" stroke-width="1.0000" fill="#000000" stroke="none"></use></marker><path stroke-linecap="round" d="M6,1 1,3.5 6,6" id="raphael-marker-open"></path><marker id="raphael-marker-endopen77-obj1279" markerHeight="7" markerWidth="7" orient="auto" refX="4" refY="3.5"><use NS2:href="#raphael-marker-open" transform="rotate(180 3.5 3.5) scale(1,1)" stroke-width="1.0000" fill="none" stroke="#000000"></use></marker><marker id="raphael-marker-endopen77-obj1282" markerHeight="7" markerWidth="7" orient="auto" refX="4" refY="3.5"><use NS3:href="#raphael-marker-open" transform="rotate(180 3.5 3.5) scale(1,1)" stroke-width="1.0000" fill="none" stroke="#000000"></use></marker><marker id="raphael-marker-endopen77-obj1285" markerHeight="7" markerWidth="7" orient="auto" refX="4" refY="3.5"><use NS4:href="#raphael-marker-open" transform="rotate(180 3.5 3.5) scale(1,1)" stroke-width="1.0000" fill="none" stroke="#000000"></use></marker><marker id="raphael-marker-endblock55-obj1288" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5"><use NS5:href="#raphael-marker-block" transform="rotate(180 2.5 2.5) scale(1,1)" stroke-width="1.0000" fill="#000000" stroke="none"></use></marker><marker id="raphael-marker-endblock55-obj1291" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5"><use NS6:href="#raphael-marker-block" transform="rotate(180 2.5 2.5) scale(1,1)" stroke-width="1.0000" fill="#000000" stroke="none"></use></marker></defs><rect x="10" y="10" width="202.03125" height="28" rx="0" ry="0" fill="#ffffff" stroke="#000000" stroke-width="2" style=""></rect><text x="15" y="24" text-anchor="start" font-family="Andale Mono, monospace" font-size="16px" stroke="none" fill="#000000" style="text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;"><tspan dy="5.515625">Pipe's communication</tspan></text><rect x="10" y="48" width="77.625" height="38" rx="0" ry="0" fill="#ffffff" stroke="#000000" stroke-width="2" style=""></rect><text x="20" y="67" text-anchor="start" font-family="Andale Mono, monospace" font-size="16px" stroke="none" fill="#000000" style="text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;"><tspan dy="5.515625">Parent</tspan></text><rect x="10" y="334" width="77.625" height="38" rx="0" ry="0" fill="#ffffff" stroke="#000000" stroke-width="2" style=""></rect><text x="20" y="353" text-anchor="start" font-family="Andale Mono, monospace" font-size="16px" stroke="none" fill="#000000" style="text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;"><tspan dy="5.515625">Parent</tspan></text><path fill="none" stroke="#000000" d="M48.8125,86L48.8125,334" stroke-width="2" style=""></path><rect x="298.875" y="48" width="96.8125" height="38" rx="0" ry="0" fill="#ffffff" stroke="#000000" stroke-width="2" style=""></rect><text x="308.875" y="67" text-anchor="start" font-family="Andale Mono, monospace" font-size="16px" stroke="none" fill="#000000" style="text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;"><tspan dy="5.515625">Children</tspan></text><rect x="298.875" y="334" width="96.8125" height="38" rx="0" ry="0" fill="#ffffff" stroke="#000000" stroke-width="2" style=""></rect><text x="308.875" y="353" text-anchor="start" font-family="Andale Mono, monospace" font-size="16px" stroke="none" fill="#000000" style="text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;"><tspan dy="5.515625">Children</tspan></text><path fill="none" stroke="#000000" d="M347.28125,86L347.28125,334" stroke-width="2" style=""></path><rect x="558.9375" y="48" width="173.625" height="38" rx="0" ry="0" fill="#ffffff" stroke="#000000" stroke-width="2" style=""></rect><text x="568.9375" y="67" text-anchor="start" font-family="Andale Mono, monospace" font-size="16px" stroke="none" fill="#000000" style="text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;"><tspan dy="5.515625">External Program</tspan></text><rect x="558.9375" y="334" width="173.625" height="38" rx="0" ry="0" fill="#ffffff" stroke="#000000" stroke-width="2" style=""></rect><text x="568.9375" y="353" text-anchor="start" font-family="Andale Mono, monospace" font-size="16px" stroke="none" fill="#000000" style="text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;"><tspan dy="5.515625">External Program</tspan></text><path fill="none" stroke="#000000" d="M645.75,86L645.75,334" stroke-width="2" style=""></path><text x="58.8125" y="111" text-anchor="start" font-family="Andale Mono, monospace" font-size="16px" stroke="none" fill="#000000" style="text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;"><tspan dy="5.515625">fork() 5 times simultaneously</tspan></text><path fill="none" stroke="#000000" d="M48.8125,124C48.8125,124,303.2739630267024,124,342.2880740571636,124" stroke-width="2" marker-end="url(#raphael-marker-endblock55-obj1276)" stroke-dasharray="0" style=""></path><text x="357.28125" y="149" text-anchor="start" font-family="Andale Mono, monospace" font-size="16px" stroke="none" fill="#000000" style="text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;"><tspan dy="5.515625">redirect pipe write to std_in</tspan></text><path fill="none" stroke="#000000" d="M347.28125,162C347.28125,162,617.7302881311625,162,643.7451614279589,162" stroke-width="2" marker-end="url(#raphael-marker-endopen77-obj1279)" stroke-dasharray="0" style=""></path><text x="357.28125" y="187" text-anchor="start" font-family="Andale Mono, monospace" font-size="16px" stroke="none" fill="#000000" style="text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;"><tspan dy="5.515625">redirect pipe read to std_out</tspan></text><path fill="none" stroke="#000000" d="M347.28125,200C347.28125,200,617.7302881311625,200,643.7451614279589,200" stroke-width="2" marker-end="url(#raphael-marker-endopen77-obj1282)" stroke-dasharray="0" style=""></path><text x="362.09375" y="225" text-anchor="start" font-family="Andale Mono, monospace" font-size="16px" stroke="none" fill="#000000" style="text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;"><tspan dy="5.515625">execlp() in diff argv[] - ID</tspan></text><path fill="none" stroke="#000000" d="M347.28125,238C347.28125,238,617.7302881311625,238,643.7451614279589,238" stroke-width="2" marker-end="url(#raphael-marker-endopen77-obj1285)" stroke-dasharray="0" style=""></path><text x="212.859375" y="263" text-anchor="start" font-family="Andale Mono, monospace" font-size="16px" stroke="none" fill="#000000" style="text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;"><tspan dy="5.515625">P to C write / C read from P</tspan></text><path fill="none" stroke="#000000" d="M48.8125,276C48.8125,276,583.2100383331999,276,640.7464920453438,276" stroke-width="2" marker-end="url(#raphael-marker-endblock55-obj1288)" stroke-dasharray="6,2" style=""></path><text x="212.859375" y="301" text-anchor="start" font-family="Andale Mono, monospace" font-size="16px" stroke="none" fill="#000000" style="text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;"><tspan dy="5.515625">C to P write / P read from C</tspan></text><path fill="none" stroke="#000000" d="M645.75,314C645.75,314,111.35246166680008,314,53.81600795465624,314" stroke-width="2" marker-end="url(#raphael-marker-endblock55-obj1291)" stroke-dasharray="6,2" style=""></path></svg></div><div class="cell markdown-cell"><div style="page-break-after: always;"></div></div><div class="cell markdown-cell"><hr>
<h1>Outline</h1>
<ol>
<li>Introduction of functions
<ol>
<li>main program - initial part - main.cpp
<ul>
<li>Parent process
<ul>
<li>main()</li>
<li>pipe</li>
<li>create child process</li>
<li>assign ID</li>
<li>reciving READY message from child</li>
</ul>
</li>
<li>Child process
<ul>
<li>getID</li>
<li>redirect pipe lines to <em>STDIN_FILENO/STDOUT_FILENO</em></li>
<li>use execlp to invoke external program</li>
</ul>
</li>
</ul>
</li>
<li>external program - initial part - child.cpp
<ul>
<li>receiveID</li>
<li>read data from input file and store in array</li>
</ul>
</li>
<li>main communication part - IPC
<ol>
<li>Parent process - main.cpp
<ul>
<li>send communicating signal(REQUEST, READY, PIVOT, SMALL,LARGE...)</li>
<li>identify the relationship between k and m, find median</li>
</ul>
</li>
<li>child process - child.cpp
<ul>
<li>calculating data</li>
<li>manage data</li>
<li>return value</li>
<li>terminates</li>
</ul>
</li>
</ol>
</li>
</ol>
</li>
<li>Key features found during the procedure of prgramming</li>
<li>Remaining Questions</li>
</ol>
</div><div class="cell markdown-cell"><div style="page-break-after: always;"></div></div><div class="cell markdown-cell"><hr>
<h1>Getting start</h1>
<p>This report will discuss all things happened during I wrote this program.  We will begin by explaining the structure and details in functions. In the meantime, I will also talk about what kinds of obstacles I met and how I sovled them.</p>
<p>To be honest, when I first read the insturctions about this assignment, I think it is a single project with mathematics and IPC.<br>
After I finished establishing the Inter process communication part in one C file. I still felt confident about how I could make this work.</p>
<p>However, the next decision I made changed everything.<br>
I chose to use child process execlp() a external process to do the job.<br>
And it helps me create the best project I ever wrote.<br>
Because I can't see anything from external process. So, I guess what happened and use pstacks to idtentify the collapse line.Tried to debug in the dark without a single light. Thousands of failer made me much more long for the sucess. It helps me think what the most important part is in a project.<br>
I went inside of all details in pipe and process. And try to figure out what makes my programm have bugs and block. I will discuss those parts throughly in next few charpters.<br>
At the end, when I finially had the 100% correct outputs , I felt extremely satisfied.<br>
Learn everything I can, before coding.<br>
Think everything I could avoid before coding.<br>
Okay, let's go to the details in my program.</p>
</div><div class="cell markdown-cell"><div style="page-break-after: always;"></div></div><div class="cell markdown-cell"><hr>
<h1>Charpter one: Intruduction of functions <br></h1>
<h2>Part ONE: Main Program (main.cpp)</h2>
<blockquote>
<p>In this part, I will throughly decribe how my program works.<br>
I will divide main program as three parts.<br>
Firstly, it is the fundamental structure to build parent process and child process(before exec). And how to establish their inter process communication.<br>
Secondly, I will briefly talk about the initial part of child process(before exec) and parent process. About how to send ID information between IPC.<br>
Eventually, we will talk about the strategy about invoking external program and its details.</p>
</blockquote>
</div><div class="cell markdown-cell"><hr>
</div><div class="cell markdown-cell"><h3>Header files and const variables includes:</h3>
</div><div class="cell code-cell"><div class="ace-monokai"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">#include</span><span class="ace_constant ace_other"> &lt;iostream&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">#include</span><span class="ace_constant ace_other"> &lt;algorithm&gt;</span>    <span class="ace_comment">// std::sort</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">#include</span><span class="ace_constant ace_other"> &lt;fstream&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">#include</span><span class="ace_constant ace_other"> &lt;stdio.h&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">#include</span><span class="ace_constant ace_other"> &lt;stdlib.h&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">#include</span><span class="ace_constant ace_other"> &lt;sys/types.h&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">#include</span><span class="ace_constant ace_other"> &lt;string.h&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">#include</span><span class="ace_constant ace_other"> &lt;unistd.h&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">#include</span><span class="ace_constant ace_other"> &lt;string.h&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">#include</span><span class="ace_constant ace_other"> &lt;fstream&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">#include</span><span class="ace_constant ace_other"> &lt;vector&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">#include</span><span class="ace_constant ace_other"> &lt;sstream&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">#include</span><span class="ace_constant ace_other"> &lt;cstdlib&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">#include</span><span class="ace_constant ace_other"> &lt;ctime&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword ace_control">using</span> <span class="ace_keyword ace_operator">namespace</span> <span class="ace_identifier">std</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment">//pipe</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">#define</span><span class="ace_constant ace_other"> READ_END 0</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">#define</span><span class="ace_constant ace_other"> WRITE_END 1</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment">//signal</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">#define</span><span class="ace_constant ace_other"> REQUEST 100         </span><span class="ace_comment">//REQUEST</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">#define</span><span class="ace_constant ace_other"> PIVOT 200           </span><span class="ace_comment">//PIVOT</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">#define</span><span class="ace_constant ace_other"> LARGE 300           </span><span class="ace_comment">//LARGE</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">#define</span><span class="ace_constant ace_other"> SMALL 400           </span><span class="ace_comment">//SMALL</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">#define</span><span class="ace_constant ace_other"> READY 500           </span><span class="ace_comment">//READY</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">#define</span><span class="ace_constant ace_other"> BREAK 2000          </span><span class="ace_comment">//BREAK</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">#define</span><span class="ace_constant ace_other"> TERMINATE 4000      </span><span class="ace_comment">//TERMINATE</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment">//reading start flag</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">#define</span><span class="ace_constant ace_other"> beginning_index 1</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment">//sleep time</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">#define</span><span class="ace_constant ace_other"> TIME 0</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">int</span> <span class="ace_identifier">ID</span> <span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">int</span> <span class="ace_identifier">msgSingal</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">int</span> <span class="ace_identifier">n</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_constant ace_numeric">5</span><span class="ace_punctuation ace_operator">;</span>
</div></div></div></div><div class="cell markdown-cell"><h2>main():</h2>
<p>First of all, let's create 10 pipes as each child has 2 pipes to communicate with parent.<br>
<img src="resources/F6B039AE772BA024AD3B3CABEC9097BE.jpg" alt="IMAGE" width="405" height="257"><img src="resources/F38F631AE49B7BC6EC04CD06B265E923.jpg" alt="IMAGE" width="424" height="315"></p>
<blockquote>
<p>By <a href="http://www.drkapoorsclinic.com/files/blog/Linux_Kernel_Implementation_of_Pipes_FIFOs.pptx">http://www.drkapoorsclinic.com/files/blog/Linux_Kernel_Implementation_of_Pipes_FIFOs.pptx</a></p>
</blockquote>
</div><div class="cell code-cell"><div class="ace-monokai"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">int</span> <span class="ace_identifier">main</span><span class="ace_paren ace_lparen">(</span><span class="ace_storage ace_type">int</span> <span class="ace_identifier">argc</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_storage ace_modifier">const</span> <span class="ace_storage ace_type">char</span> <span class="ace_keyword ace_operator">*</span> <span class="ace_identifier">argv</span><span class="ace_paren ace_lparen">[</span><span class="ace_paren ace_rparen">])</span> <span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_comment">// Generate 25 random numbers into 5 input_file</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_comment">//    generateInputFiles();</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_support ace_function ace_C99 ace_c">printf</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_string">Process communication program begin.</span><span class="ace_constant ace_language ace_escape">\n</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_storage ace_type">int</span> <span class="ace_identifier">fds</span><span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">10</span><span class="ace_paren ace_rparen">]</span><span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">2</span><span class="ace_paren ace_rparen">]</span><span class="ace_punctuation ace_operator">;</span> <span class="ace_comment">// pipes</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_storage ace_type">char</span> <span class="ace_identifier">buf</span><span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">1024</span><span class="ace_paren ace_rparen">]</span><span class="ace_punctuation ace_operator">;</span> <span class="ace_comment">// container of messages</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_storage ace_type">int</span> <span class="ace_identifier">times</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_constant ace_numeric">0</span><span class="ace_punctuation ace_operator">;</span> 
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_keyword ace_control">for</span> <span class="ace_paren ace_lparen">(</span><span class="ace_storage ace_type">int</span> <span class="ace_identifier">i</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_constant ace_numeric">0</span><span class="ace_punctuation ace_operator">;</span> <span class="ace_identifier">i</span> <span class="ace_keyword ace_operator">&lt;</span> <span class="ace_constant ace_numeric">10</span><span class="ace_punctuation ace_operator">;</span> <span class="ace_identifier">i</span><span class="ace_keyword ace_operator">++</span><span class="ace_paren ace_rparen">)</span> <span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">pipe</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">fds</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">i</span><span class="ace_paren ace_rparen">])</span><span class="ace_punctuation ace_operator">;</span>   <span class="ace_comment">// create pipes with VFS</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_paren ace_rparen">}</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">pid_t</span> <span class="ace_identifier">pid</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span> 
</div></div></div></div><div class="cell markdown-cell"><p>And then we create 5 children process at the same time.<br>
At the moment, I used a strategy from a website.</p>
<blockquote>
<p>Ref : <a href="https://blog.csdn.net/cupidove/article/details/9297335">https://blog.csdn.net/cupidove/article/details/9297335</a></p>
</blockquote>
<p>He set a if - break statement in for loop, every time when pid == 0 then break, which makes child process will not continue to fork sub-child process.</p>
</div><div class="cell code-cell"><div class="ace-monokai"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_comment">// fork 5 children processes</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_support ace_function ace_C99 ace_c">printf</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_string">Starting fork children process.</span><span class="ace_constant ace_language ace_escape">\n</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_keyword ace_control">for</span> <span class="ace_paren ace_lparen">(</span><span class="ace_storage ace_type">int</span> <span class="ace_identifier">i</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_constant ace_numeric">0</span> <span class="ace_punctuation ace_operator">;</span> <span class="ace_identifier">i</span> <span class="ace_keyword ace_operator">&lt;</span> <span class="ace_constant ace_numeric">5</span><span class="ace_punctuation ace_operator">;</span> <span class="ace_identifier">i</span><span class="ace_keyword ace_operator">++</span><span class="ace_paren ace_rparen">)</span> <span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">pid</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">fork</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_keyword ace_control">if</span> <span class="ace_paren ace_lparen">(</span><span class="ace_identifier">pid</span> <span class="ace_keyword ace_operator">!=</span> <span class="ace_constant ace_numeric">0</span> <span class="ace_keyword ace_operator">&amp;&amp;</span> <span class="ace_identifier">pid</span> <span class="ace_keyword ace_operator">!=</span> <span class="ace_constant ace_numeric">-1</span><span class="ace_paren ace_rparen">)</span> <span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>    <span class="ace_support ace_function ace_C99 ace_c">printf</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_string">NO. </span><span class="ace_constant ace_language ace_escape">%d</span><span class="ace_string"> Child has been forked by parent</span><span class="ace_constant ace_language ace_escape">\n</span><span class="ace_string ace_end">"</span> <span class="ace_punctuation ace_operator">,</span> <span class="ace_identifier">i</span> <span class="ace_keyword ace_operator">+</span> <span class="ace_constant ace_numeric">1</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_paren ace_rparen">}</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">sleep</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">1</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_keyword ace_control">if</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">pid</span> <span class="ace_keyword ace_operator">==</span> <span class="ace_constant ace_numeric">0</span> <span class="ace_keyword ace_operator">||</span> <span class="ace_identifier">pid</span> <span class="ace_keyword ace_operator">==</span> <span class="ace_constant ace_numeric">-1</span><span class="ace_paren ace_rparen">)</span><span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>    <span class="ace_keyword ace_control">break</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>    <span class="ace_comment">//Ref : https://blog.csdn.net/cupidove/article/details/9297335</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_paren ace_rparen">}</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_paren ace_rparen">}</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    
</div></div></div></div><div class="cell markdown-cell"><p>After we forked 5 children process.<br>
Then we go to if else statment, to distinguish parent process and children process.<br>
By pid == 0 (child process) or pid &gt; 0 (parent process)</p>
</div><div class="cell code-cell"><div class="ace-monokai"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span> <span class="ace_keyword ace_control">if</span> <span class="ace_paren ace_lparen">(</span><span class="ace_identifier">pid</span> <span class="ace_keyword ace_operator">&lt;</span> <span class="ace_constant ace_numeric">0</span><span class="ace_paren ace_rparen">)</span><span class="ace_paren ace_lparen">{</span><span class="ace_comment">/* error occurred*/</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_support ace_function ace_C99 ace_c">fprintf</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">stderr</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_string ace_start">"</span><span class="ace_string">Fork Failed</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_keyword ace_control">return</span> <span class="ace_constant ace_numeric">1</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_paren ace_rparen">}</span><span class="ace_keyword ace_control">else</span> <span class="ace_keyword ace_control">if</span> <span class="ace_paren ace_lparen">(</span><span class="ace_identifier">pid</span> <span class="ace_keyword ace_operator">==</span> <span class="ace_constant ace_numeric">0</span><span class="ace_paren ace_rparen">)</span> <span class="ace_paren ace_lparen">{</span> <span class="ace_comment">/* child process*/</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">childGetID</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">fds</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">pipeToSTD_IN_OUT</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">fds</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_comment">//        string filename = "/home/student/z_jia/AS1/child";</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">string</span> <span class="ace_identifier">filename</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_string ace_start">"</span><span class="ace_string">/Users/WillJia/Documents/Pipe/child/child</span><span class="ace_string ace_end">"</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">childExecProgram</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">filename</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">c_str</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">))</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_paren ace_rparen">}</span><span class="ace_keyword ace_control">else</span><span class="ace_paren ace_lparen">{</span> <span class="ace_comment">/* parent process*/</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_comment">/*</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_comment"> • It allots ids 1-5 to each of the children and sends the same along the parent→child pipe.</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_comment"> */</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">assignID</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">fds</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_comment">/*</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_comment"> • The parent waits on all the child→parent pipes until it receives the code READY from all</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_comment"> child processes. This ensures that the algorithm initiates only after all child processes</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_comment"> have read the input completely.</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_comment"> */</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">waitForReady</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">fds</span> <span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div></div></div></div><div class="cell markdown-cell"><h2><strong><em>Now, We discuss the whole communication procedure by swtiching locations from parent to child in main.cpp. For simulating the things happen between P and C by timeline.</em></strong></h2>
</div><div class="cell markdown-cell"><p>First of all, I create a communication rule between P and C.<br>
As for even number for P2C, odd number for C2P.<br>
By this particular rule, I can make every pipe write and read by child ID without advanced calculating.</p>
</div><div class="cell code-cell"><div class="ace-monokai"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc">/** piping index rules :</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> * even number for parent-to-children's write_communication</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> * index = id * 2 - 2</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> * odd  number for children-to-parent's write_communication</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> * index = id * 2 - 1</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> */</span>
</div></div></div></div><div class="cell markdown-cell"><p>So, I wrote four encapsulation methods by myself to make pipe write / read more easily.</p>
</div><div class="cell code-cell"><div class="ace-monokai"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc">/************************************************************************</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> </span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> Function:        P2C_write</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> </span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> Description:     parent write to child</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> </span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> *************************************************************************/</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">void</span> <span class="ace_identifier">P2C_write</span><span class="ace_paren ace_lparen">(</span><span class="ace_storage ace_type">int</span> <span class="ace_identifier">fds</span><span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">10</span><span class="ace_paren ace_rparen">]</span><span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">2</span><span class="ace_paren ace_rparen">]</span> <span class="ace_punctuation ace_operator">,</span> <span class="ace_storage ace_type">int</span> <span class="ace_identifier">index</span> <span class="ace_punctuation ace_operator">,</span> <span class="ace_storage ace_modifier">const</span> <span class="ace_storage ace_type">void</span> <span class="ace_keyword ace_operator">*</span><span class="ace_identifier">__buf</span> <span class="ace_punctuation ace_operator">,</span> <span class="ace_identifier">size_t</span> <span class="ace_identifier">__nbyte</span><span class="ace_paren ace_rparen">)</span><span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">close</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">fds</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">index</span> <span class="ace_keyword ace_operator">*</span> <span class="ace_constant ace_numeric">2</span> <span class="ace_keyword ace_operator">-</span> <span class="ace_constant ace_numeric">2</span><span class="ace_paren ace_rparen">]</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">READ_END</span><span class="ace_paren ace_rparen">])</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">write</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">fds</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">index</span> <span class="ace_keyword ace_operator">*</span> <span class="ace_constant ace_numeric">2</span> <span class="ace_keyword ace_operator">-</span> <span class="ace_constant ace_numeric">2</span><span class="ace_paren ace_rparen">]</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">WRITE_END</span><span class="ace_paren ace_rparen">]</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_identifier">__buf</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_identifier">__nbyte</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">}</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc">/************************************************************************</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> </span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> Function:        P_from_C_read</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> </span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> Description:     parent read from child</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> </span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> *************************************************************************/</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">void</span> <span class="ace_identifier">P_from_C_read</span><span class="ace_paren ace_lparen">(</span><span class="ace_storage ace_type">int</span> <span class="ace_identifier">fds</span><span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">10</span><span class="ace_paren ace_rparen">]</span><span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">2</span><span class="ace_paren ace_rparen">]</span> <span class="ace_punctuation ace_operator">,</span> <span class="ace_storage ace_type">int</span> <span class="ace_identifier">index</span> <span class="ace_punctuation ace_operator">,</span> <span class="ace_storage ace_type">void</span> <span class="ace_keyword ace_operator">*</span><span class="ace_identifier">__buf</span> <span class="ace_punctuation ace_operator">,</span> <span class="ace_identifier">size_t</span> <span class="ace_identifier">__nbyte</span><span class="ace_paren ace_rparen">)</span><span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">close</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">fds</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">index</span> <span class="ace_keyword ace_operator">*</span> <span class="ace_constant ace_numeric">2</span> <span class="ace_keyword ace_operator">-</span> <span class="ace_constant ace_numeric">1</span><span class="ace_paren ace_rparen">]</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">WRITE_END</span><span class="ace_paren ace_rparen">])</span><span class="ace_punctuation ace_operator">;</span>                    <span class="ace_comment">// close C2P write_end</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">read</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">fds</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">index</span> <span class="ace_keyword ace_operator">*</span> <span class="ace_constant ace_numeric">2</span> <span class="ace_keyword ace_operator">-</span> <span class="ace_constant ace_numeric">1</span><span class="ace_paren ace_rparen">]</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">READ_END</span><span class="ace_paren ace_rparen">]</span> <span class="ace_punctuation ace_operator">,</span><span class="ace_identifier">__buf</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_identifier">__nbyte</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>      <span class="ace_comment">// start read</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">}</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc">/************************************************************************</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> </span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> Function:        C2P_write</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> </span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> Description:     child write to parent</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> </span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> *************************************************************************/</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">void</span> <span class="ace_identifier">C2P_write</span><span class="ace_paren ace_lparen">(</span><span class="ace_storage ace_type">int</span> <span class="ace_identifier">fds</span><span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">10</span><span class="ace_paren ace_rparen">]</span><span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">2</span><span class="ace_paren ace_rparen">]</span> <span class="ace_punctuation ace_operator">,</span> <span class="ace_storage ace_type">int</span> <span class="ace_identifier">index</span> <span class="ace_punctuation ace_operator">,</span> <span class="ace_storage ace_modifier">const</span> <span class="ace_storage ace_type">void</span> <span class="ace_keyword ace_operator">*</span><span class="ace_identifier">__buf</span> <span class="ace_punctuation ace_operator">,</span> <span class="ace_identifier">size_t</span> <span class="ace_identifier">__nbyte</span><span class="ace_paren ace_rparen">)</span><span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">close</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">fds</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">index</span> <span class="ace_keyword ace_operator">*</span> <span class="ace_constant ace_numeric">2</span> <span class="ace_keyword ace_operator">-</span> <span class="ace_constant ace_numeric">1</span><span class="ace_paren ace_rparen">]</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">READ_END</span><span class="ace_paren ace_rparen">])</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">write</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">fds</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">index</span> <span class="ace_keyword ace_operator">*</span> <span class="ace_constant ace_numeric">2</span> <span class="ace_keyword ace_operator">-</span> <span class="ace_constant ace_numeric">1</span><span class="ace_paren ace_rparen">]</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">WRITE_END</span><span class="ace_paren ace_rparen">]</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_identifier">__buf</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_identifier">__nbyte</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">}</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc">/************************************************************************</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> </span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> Function:        C_from_P_read</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> </span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> Description:     child read from parent</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> </span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> *************************************************************************/</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">void</span> <span class="ace_identifier">C_from_P_read</span><span class="ace_paren ace_lparen">(</span><span class="ace_storage ace_type">int</span> <span class="ace_identifier">fds</span><span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">10</span><span class="ace_paren ace_rparen">]</span><span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">2</span><span class="ace_paren ace_rparen">]</span> <span class="ace_punctuation ace_operator">,</span> <span class="ace_storage ace_type">int</span> <span class="ace_identifier">index</span> <span class="ace_punctuation ace_operator">,</span> <span class="ace_storage ace_type">void</span> <span class="ace_keyword ace_operator">*</span> <span class="ace_identifier">__buf</span> <span class="ace_punctuation ace_operator">,</span> <span class="ace_identifier">size_t</span> <span class="ace_identifier">__nbyte</span><span class="ace_paren ace_rparen">)</span><span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">close</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">fds</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">index</span> <span class="ace_keyword ace_operator">*</span> <span class="ace_constant ace_numeric">2</span> <span class="ace_keyword ace_operator">-</span> <span class="ace_constant ace_numeric">2</span><span class="ace_paren ace_rparen">]</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">WRITE_END</span><span class="ace_paren ace_rparen">])</span><span class="ace_punctuation ace_operator">;</span>                    <span class="ace_comment">// close C2P write_end</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">read</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">fds</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">index</span> <span class="ace_keyword ace_operator">*</span> <span class="ace_constant ace_numeric">2</span> <span class="ace_keyword ace_operator">-</span> <span class="ace_constant ace_numeric">2</span><span class="ace_paren ace_rparen">]</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">READ_END</span><span class="ace_paren ace_rparen">]</span> <span class="ace_punctuation ace_operator">,</span> <span class="ace_identifier">__buf</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_identifier">__nbyte</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span> <span class="ace_comment">// start read</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">}</span>
</div></div></div></div><div class="cell markdown-cell"><p>After that, I still think it's not enough. Because sometimes we need sending char[] buf messages, and sometimes we need sending int variable. As we know, although system call write/read has no restrictions on the type of variable, which means we can send int to child process and use another int to contain their values, it still could have mistakes. Because the developer needs to remember when the variable is char[] and when the variable is int. Based on the different between two types, there are a lot of more works that need to be done.<br>
So, I decide to change every types of varaible to char[] variable.<br>
It makes my code more flexiable, because even if we forget what type we sent, we can still use printf("%s",buf); to figure out what happened.</p>
</div><div class="cell code-cell"><div class="ace-monokai"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc">/************************************************************************</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> </span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> Function:        p2c_send_signal</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> </span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> Description:     parent send signal to  all child</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> </span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> *************************************************************************/</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">void</span> <span class="ace_identifier">p2c_send_signal</span><span class="ace_paren ace_lparen">(</span><span class="ace_storage ace_type">int</span> <span class="ace_identifier">fds</span><span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">10</span><span class="ace_paren ace_rparen">]</span><span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">2</span><span class="ace_paren ace_rparen">]</span> <span class="ace_punctuation ace_operator">,</span> <span class="ace_storage ace_type">int</span> <span class="ace_identifier">index</span> <span class="ace_punctuation ace_operator">,</span> <span class="ace_storage ace_type">int</span> <span class="ace_support ace_function ace_C99 ace_c">signal</span> <span class="ace_paren ace_rparen">)</span><span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">std</span><span class="ace_punctuation ace_operator">::</span><span class="ace_identifier">string</span> <span class="ace_identifier">s</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">std</span><span class="ace_punctuation ace_operator">::</span><span class="ace_identifier">to_string</span><span class="ace_paren ace_lparen">(</span><span class="ace_support ace_function ace_C99 ace_c">signal</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_storage ace_type">char</span> <span class="ace_storage ace_modifier">const</span> <span class="ace_keyword ace_operator">*</span><span class="ace_identifier">pchar</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">s</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">c_str</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">P2C_write</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">fds</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_identifier">index</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_identifier">pchar</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_keyword ace_operator">sizeof</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">pchar</span><span class="ace_paren ace_rparen">))</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">}</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div></div></div></div><div class="cell markdown-cell"><h2><strong><em>After those fundamental methods finished, we will fully discuss about the procedure about how does P to C communication establish</em></strong></h2>
</div><div class="cell markdown-cell"><h3>We start from Parent Process</h3>
<h4>assignID(fds);</h4>
<p>In my thought, it is a key feature to assign ID to children process at the beginning. Because in each child they has same PCB from parent. So, their data won't be different.<br>
I observed that all children already inherit 10 pipes. And all the code in child process block are the same.<br>
So, it's hard to distinguish ID by code.<br>
And when I serached the details in pipe system calls.<br>
I know that if P write into pipe, and C read from pipe. Then the buffer will be cleared after reading, which means if Parent send different IDs to pipe, as long as children keep reading from pipe, it will not block.<br>
And use one read() in child process, there will invoke K read() to reach from parent.<br>
SO, how about using only one pipe?</p>
</div><div class="cell code-cell"><div class="ace-monokai"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc">/************************************************************************</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> </span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> Function:        assignID</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> </span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> Description:     assignID to child process</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> </span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> *************************************************************************/</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">void</span> <span class="ace_identifier">assignID</span><span class="ace_paren ace_lparen">(</span><span class="ace_storage ace_type">int</span> <span class="ace_identifier">fds</span><span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">10</span><span class="ace_paren ace_rparen">]</span><span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">2</span><span class="ace_paren ace_rparen">])</span><span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_keyword ace_control">for</span><span class="ace_paren ace_lparen">(</span><span class="ace_storage ace_type">int</span> <span class="ace_identifier">i</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_constant ace_numeric">1</span><span class="ace_punctuation ace_operator">;</span> <span class="ace_identifier">i</span> <span class="ace_keyword ace_operator">&lt;</span> <span class="ace_constant ace_numeric">6</span> <span class="ace_punctuation ace_operator">;</span> <span class="ace_identifier">i</span><span class="ace_keyword ace_operator">++</span><span class="ace_paren ace_rparen">)</span><span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">ID</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">i</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">P2C_write</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">fds</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_constant ace_numeric">1</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_keyword ace_operator">&amp;</span><span class="ace_identifier">ID</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_keyword ace_operator">sizeof</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">ID</span><span class="ace_paren ace_rparen">))</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_comment">// index = 1 for first 2 pipes.</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_comment">// and P2C_write will operate in pipe[0]</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_paren ace_rparen">}</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">}</span>
</div></div></div></div><div class="cell markdown-cell"><p>It works.</p>
<hr>
<h3>Then we switch to children process code.</h3>
<h4>childGetID(fds);</h4>
<p>The first line of children process code.<br>
Because we talk about the strategy of sending IDs before, then child process read pipe[0] directly.<br>
And at this moment, all 5 children processes are already forked.<br>
Then they are waiting for parent sending message. Someone, called it pipe reading block.<br>
So, as long as the parent send IDs one by one, there always will be a child process read the correct message of ID and then it will go to next execute line.<br>
Then next child read.<br>
After all 5 children read sucessfully from parent.<br>
All ID assgin and ID get work done.</p>
</div><div class="cell code-cell"><div class="ace-monokai"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc">/************************************************************************</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> </span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> Function:        childGetID</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> </span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> Description:     child get ID</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> </span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> *************************************************************************/</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">void</span> <span class="ace_identifier">childGetID</span><span class="ace_paren ace_lparen">(</span><span class="ace_storage ace_type">int</span> <span class="ace_identifier">fds</span><span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">10</span><span class="ace_paren ace_rparen">]</span><span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">2</span><span class="ace_paren ace_rparen">])</span><span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">C_from_P_read</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">fds</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_constant ace_numeric">1</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_keyword ace_operator">&amp;</span><span class="ace_identifier">ID</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_keyword ace_operator">sizeof</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">ID</span><span class="ace_paren ace_rparen">))</span><span class="ace_punctuation ace_operator">;</span> <span class="ace_comment">// use 0 pipe for original communicating</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">}</span>
</div></div></div></div><div class="cell markdown-cell"><hr>
<h2>Next Step is the most important function in all programs.</h2>
<h3><font color="#DC143C">-- Redirect pipe lines to  STDIN_FILENO and  STDOUT_FILENO</font></h3>
<p>As we know, once we use exec family functions invoke external program. It will execture a complied file, terminate the previously child process and become a new process.<br>
And the data saving in previously PCB will be cleared.<br>
Therefore, new external process (we call it ET process only now) will no longer has value of pipes.<br>
I spent a few hours tring to figure out a solution.<br>
And I find a solution on a website:</p>
<blockquote>
<p>Ref: <a href="https://stackoverflow.com/questions/51996946/c-both-input-and-output-pipe-to-the-external-program">https://stackoverflow.com/questions/51996946/c-both-input-and-output-pipe-to-the-external-program</a></p>
</blockquote>
<p>So, in order to make ET process still have access to pipes.<br>
We redirect children own 2 pipe lines to ET process's STDIN_FILENO port and STDOUT_FILENO port.</p>
</div><div class="cell code-cell"><div class="ace-monokai"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc">/************************************************************************</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> </span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> Function:        pipeToSTD_IN_OUT</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> </span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> Description:     change pipe to std:in and std:out</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> </span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> *************************************************************************/</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">void</span> <span class="ace_identifier">pipeToSTD_IN_OUT</span><span class="ace_paren ace_lparen">(</span><span class="ace_storage ace_type">int</span> <span class="ace_identifier">fds</span><span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">10</span><span class="ace_paren ace_rparen">]</span><span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">2</span><span class="ace_paren ace_rparen">])</span><span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_comment">/* initialize pipe. */</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_comment ace_doc">/** piping index rules :</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_comment ace_doc"> * even number for parent-to-children's write_communication</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_comment ace_doc"> * index = id * 2 - 2</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_comment ace_doc"> * odd  number for children-to-parent's write_communication</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_comment ace_doc"> * index = id * 2 - 1</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_comment ace_doc"> */</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_comment">/* change pipe into std::in and std::out mode */</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">close</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">fds</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">ID</span> <span class="ace_keyword ace_operator">*</span> <span class="ace_constant ace_numeric">2</span> <span class="ace_keyword ace_operator">-</span> <span class="ace_constant ace_numeric">2</span><span class="ace_paren ace_rparen">]</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">WRITE_END</span><span class="ace_paren ace_rparen">])</span><span class="ace_punctuation ace_operator">;</span> <span class="ace_comment">// close P2C write end</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">close</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">fds</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">ID</span> <span class="ace_keyword ace_operator">*</span> <span class="ace_constant ace_numeric">2</span> <span class="ace_keyword ace_operator">-</span> <span class="ace_constant ace_numeric">1</span><span class="ace_paren ace_rparen">]</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">READ_END</span><span class="ace_paren ace_rparen">])</span><span class="ace_punctuation ace_operator">;</span>  <span class="ace_comment">// close C2P read end</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">dup2</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">fds</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">ID</span> <span class="ace_keyword ace_operator">*</span> <span class="ace_constant ace_numeric">2</span> <span class="ace_keyword ace_operator">-</span> <span class="ace_constant ace_numeric">2</span><span class="ace_paren ace_rparen">]</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">READ_END</span><span class="ace_paren ace_rparen">]</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_identifier">STDIN_FILENO</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>    <span class="ace_comment">//P2C</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">dup2</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">fds</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">ID</span> <span class="ace_keyword ace_operator">*</span> <span class="ace_constant ace_numeric">2</span> <span class="ace_keyword ace_operator">-</span> <span class="ace_constant ace_numeric">1</span><span class="ace_paren ace_rparen">]</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">WRITE_END</span><span class="ace_paren ace_rparen">]</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_identifier">STDOUT_FILENO</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>  <span class="ace_comment">//C2P</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_comment">// you should be able now to close the two remaining</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_comment">// pipe file desciptors as well as you dup'ed them already</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_comment">// (confirmed that it is working)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">close</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">fds</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">ID</span> <span class="ace_keyword ace_operator">*</span> <span class="ace_constant ace_numeric">2</span> <span class="ace_keyword ace_operator">-</span> <span class="ace_constant ace_numeric">2</span><span class="ace_paren ace_rparen">]</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">READ_END</span><span class="ace_paren ace_rparen">])</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">close</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">fds</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">ID</span> <span class="ace_keyword ace_operator">*</span> <span class="ace_constant ace_numeric">2</span> <span class="ace_keyword ace_operator">-</span> <span class="ace_constant ace_numeric">1</span><span class="ace_paren ace_rparen">]</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">WRITE_END</span><span class="ace_paren ace_rparen">])</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_comment">/*Ref: https://stackoverflow.com/questions/51996946/c-both-input-and-output-pipe-to-the-external-program*/</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">}</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div></div></div></div><div class="cell markdown-cell"><p>After this functions, we can use <code>read(STDIN_FILENO , buf, sizeof(buf))</code> and <code>write(STDOUT_FILENO , buf, sizeof(buf))</code> to get information from pipes in ET process.</p>
</div><div class="cell markdown-cell"><hr>
<h2>Then we execlp() a new process.</h2>
</div><div class="cell code-cell"><div class="ace-monokai"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc">/************************************************************************</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> </span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> Function:        childExecProgram</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> </span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> Description:     child exec program</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> </span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> *************************************************************************/</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">void</span> <span class="ace_identifier">childExecProgram</span><span class="ace_paren ace_lparen">(</span><span class="ace_storage ace_modifier">const</span> <span class="ace_storage ace_type">char</span><span class="ace_keyword ace_operator">*</span> <span class="ace_identifier">filename</span><span class="ace_paren ace_rparen">)</span><span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_comment">/* change ID to char* */</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">std</span><span class="ace_punctuation ace_operator">::</span><span class="ace_identifier">string</span> <span class="ace_identifier">s</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">std</span><span class="ace_punctuation ace_operator">::</span><span class="ace_identifier">to_string</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">ID</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_storage ace_type">char</span> <span class="ace_storage ace_modifier">const</span> <span class="ace_keyword ace_operator">*</span><span class="ace_identifier">pchar</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">s</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">c_str</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_comment">/* drop child process, change into a new  running program */</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_keyword ace_control">if</span> <span class="ace_paren ace_lparen">(</span><span class="ace_identifier">execlp</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">filename</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_identifier">pchar</span> <span class="ace_punctuation ace_operator">,</span> <span class="ace_constant ace_language">NULL</span><span class="ace_paren ace_rparen">)</span><span class="ace_keyword ace_operator">&lt;</span><span class="ace_constant ace_numeric">0</span><span class="ace_paren ace_rparen">)</span><span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_support ace_function ace_C99 ace_c">printf</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_string">Wrong!!</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_paren ace_rparen">}</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">}</span>
</div></div></div></div><div class="cell markdown-cell"><p>There are a lot of information and knowledge points in exec family. Please read from online or book source. I will omit those for now.<br>
In my function <code>childExecProgram(const char* filename)</code>,<br>
we will use execlp() function to execute a new program.<br>
pchar will be the argument to argv[] at<code>int main(int argc, const char * argv[])</code>.<br>
And because of argv[], we can send ID to the new process.</p>
<hr>
<h2><strong><em>And at this point,inter process communication lines between parent process and ET process (external process) is established.</em></strong></h2>
</div><div class="cell markdown-cell"><div style="page-break-after: always;"></div></div><div class="cell markdown-cell"><hr>
<h2>Part TWO: External programm (child process)</h2>
</div><div class="cell markdown-cell"><h3>Now, we go to the new child process source file as the ET process we mentioned before. We will call it child process from now on.</h3>
<h3><strong><em>child.cpp</em></strong></h3>
<p>Same header file and global variables are:</p>
</div><div class="cell code-cell"><div class="ace-monokai"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment">//pipe</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">#define</span><span class="ace_constant ace_other"> READ_END 0</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">#define</span><span class="ace_constant ace_other"> WRITE_END 1</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment">//signal</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">#define</span><span class="ace_constant ace_other"> REQUEST 100 </span><span class="ace_comment">//REQUEST</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">#define</span><span class="ace_constant ace_other"> PIVOT 200   </span><span class="ace_comment">//PIVOT</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">#define</span><span class="ace_constant ace_other"> LARGE 300   </span><span class="ace_comment">//LARGE</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">#define</span><span class="ace_constant ace_other"> SMALL 400   </span><span class="ace_comment">//SMALL</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">#define</span><span class="ace_constant ace_other"> READY 500   </span><span class="ace_comment">//READY</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">#define</span><span class="ace_constant ace_other"> SUM 600     </span><span class="ace_comment">//SUM</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">#define</span><span class="ace_constant ace_other"> BREAK 2000  </span><span class="ace_comment">//BREAK</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">#define</span><span class="ace_constant ace_other"> TERMINATE 4000  </span><span class="ace_comment">//TERMINATE</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment">//reading start flag</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">#define</span><span class="ace_constant ace_other"> parent_to_child_write_beginning 0</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">#define</span><span class="ace_constant ace_other"> child_to_parent_write_beginning 1</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment">/* initialize pipe. */</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc">/** piping index rules :</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> * even number for parent-to-children's write_communication</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> * index = id * 2 - 2</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> * odd  number for children-to-parent's write_communication</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> * index = id * 2 - 1</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> */</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">int</span> <span class="ace_identifier">ID</span> <span class="ace_punctuation ace_operator">;</span> <span class="ace_comment">// child ID</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">int</span> <span class="ace_identifier">pivot_num</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div></div></div></div><div class="cell markdown-cell"><p>Once we get into the new child process, and recive the ID from argv[].</p>
</div><div class="cell code-cell"><div class="ace-monokai"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc">/************************************************************************</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> </span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> Function:        getID</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> </span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> Description:     get ID from **argv</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> </span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> *************************************************************************/</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">void</span> <span class="ace_identifier">getID</span><span class="ace_paren ace_lparen">(</span><span class="ace_storage ace_modifier">const</span> <span class="ace_storage ace_type">char</span> <span class="ace_keyword ace_operator">*</span> <span class="ace_identifier">argv</span><span class="ace_paren ace_lparen">[</span><span class="ace_paren ace_rparen">])</span><span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">ID</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_support ace_function ace_C99 ace_c">atoi</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">argv</span><span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">0</span><span class="ace_paren ace_rparen">])</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">}</span>
</div></div></div></div><div class="cell markdown-cell"><p>Then the first thing we do is that obtaining data of <code>input_(ID).txt</code> into an array.<br>
And if the array is correct with 5 values in it, then send <code>READY</code> to parent.</p>
</div><div class="cell markdown-cell"><h3>main()</h3>
</div><div class="cell code-cell"><div class="ace-monokai"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_storage ace_type">int</span> <span class="ace_identifier">main</span><span class="ace_paren ace_lparen">(</span><span class="ace_storage ace_type">int</span> <span class="ace_identifier">argc</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_storage ace_modifier">const</span> <span class="ace_storage ace_type">char</span> <span class="ace_keyword ace_operator">*</span> <span class="ace_identifier">argv</span><span class="ace_paren ace_lparen">[</span><span class="ace_paren ace_rparen">])</span> <span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_support ace_function ace_C99 ace_c">srand</span><span class="ace_paren ace_lparen">((</span><span class="ace_storage ace_type">int</span><span class="ace_paren ace_rparen">)</span><span class="ace_support ace_function ace_C99 ace_c">time</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_language">NULL</span><span class="ace_paren ace_rparen">))</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_storage ace_type">char</span> <span class="ace_identifier">buf</span><span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">2048</span><span class="ace_paren ace_rparen">]</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_comment">//Done : change array to vector&lt;int&gt;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">vector</span><span class="ace_keyword ace_operator">&lt;</span><span class="ace_storage ace_type">int</span><span class="ace_keyword ace_operator">&gt;</span> <span class="ace_identifier">array</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">getID</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">argv</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">array</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">readingArray</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div></div></div></div><div class="cell markdown-cell"><h3>readingArray()</h3>
<p>I used <code>vector&lt;int&gt;</code> to be the array. Because vector has dynamic items. It is easy to add/delete items and get its size .<br>
Reading data from a file is easy. So, this part will be omitted for now.<br>
After we get the right array from the <code>vector&lt;int&gt;</code>, we add array values with delim as <code>/</code> between each element and put them into a new string.<br>
However, in this case, 5 numbers with 4 <code>/</code> is larger than the limit of a char[] buf can contain. The parent process will only get half of the string.</p>
<p>After a lot of times failer trying, I use 2 strings to contain those information. Send to parent process twice.<br>
After sending array values to parent process.<br>
Then we send <code>READY</code> to parent at the end.</p>
<blockquote>
<p>In this part of code, there is a huge bug which happened in my early version of codes. It caused a lot of times random pipe block between successful runnings. The rate is nearly to 1 failed / 20 success.<br>
And I will talk about this situation in whole Charpter 2.<br>
I spent almost 90% time to fix this problem in the dark.<br>
But right now, we focus on functions stucture.</p>
</blockquote>
</div><div class="cell code-cell"><div class="ace-monokai"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc">/************************************************************************</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> </span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> Function:        readingArray</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> </span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> Description:     whole procedure of reading array</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> </span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment ace_doc"> *************************************************************************/</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">vector</span><span class="ace_keyword ace_operator">&lt;</span><span class="ace_storage ace_type">int</span><span class="ace_keyword ace_operator">&gt;</span> <span class="ace_identifier">readingArray</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span><span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_storage ace_type">char</span> <span class="ace_identifier">buf</span><span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">1024</span><span class="ace_paren ace_rparen">]</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_storage ace_type">int</span> <span class="ace_identifier">n</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_constant ace_numeric">0</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment">//    ID = 1;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_comment">/* reading array */</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">vector</span><span class="ace_keyword ace_operator">&lt;</span><span class="ace_storage ace_type">int</span><span class="ace_keyword ace_operator">&gt;</span> <span class="ace_identifier">array</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">string</span> <span class="ace_identifier">info</span> <span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">string</span> <span class="ace_identifier">info2</span> <span class="ace_keyword ace_operator">=</span><span class="ace_string ace_start">"</span><span class="ace_string">/</span><span class="ace_string ace_end">"</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">array</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">processFile</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_string">/Users/WillJia/Documents/Pipe/median/input_</span><span class="ace_string ace_end">"</span> <span class="ace_keyword ace_operator">+</span> <span class="ace_identifier">to_string</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">ID</span><span class="ace_paren ace_rparen">)</span> <span class="ace_keyword ace_operator">+</span>  <span class="ace_string ace_start">"</span><span class="ace_string">.txt</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment">//    array = processFile("input_" + to_string(ID) +  ".txt");</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_comment">// check capacity of array</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_comment">// TODO: why one buf can't send all info</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_keyword ace_control">for</span> <span class="ace_paren ace_lparen">(</span><span class="ace_storage ace_type">int</span> <span class="ace_identifier">i</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_constant ace_numeric">0</span><span class="ace_punctuation ace_operator">;</span> <span class="ace_identifier">i</span> <span class="ace_keyword ace_operator">&lt;</span> <span class="ace_identifier">array</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">size</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span> <span class="ace_punctuation ace_operator">;</span> <span class="ace_identifier">i</span><span class="ace_keyword ace_operator">++</span><span class="ace_paren ace_rparen">)</span> <span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_keyword ace_control">if</span> <span class="ace_paren ace_lparen">(</span><span class="ace_identifier">array</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">i</span><span class="ace_paren ace_rparen">]</span> <span class="ace_keyword ace_operator">!=</span> <span class="ace_constant ace_numeric">0</span><span class="ace_paren ace_rparen">)</span> <span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">n</span><span class="ace_keyword ace_operator">++</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>    <span class="ace_keyword ace_control">if</span> <span class="ace_paren ace_lparen">(</span><span class="ace_identifier">i</span> <span class="ace_keyword ace_operator">&lt;</span> <span class="ace_constant ace_numeric">3</span><span class="ace_paren ace_rparen">)</span> <span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">info</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">append</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">to_string</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">array</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">i</span><span class="ace_paren ace_rparen">]))</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">info</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">append</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_string">/</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>    <span class="ace_paren ace_rparen">}</span><span class="ace_keyword ace_control">else</span><span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">info2</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">append</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">to_string</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">array</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">i</span><span class="ace_paren ace_rparen">]))</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">info2</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">append</span><span class="ace_paren ace_lparen">(</span><span class="ace_string ace_start">"</span><span class="ace_string">/</span><span class="ace_string ace_end">"</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>    <span class="ace_paren ace_rparen">}</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>   
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_paren ace_rparen">}</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_paren ace_rparen">}</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_keyword ace_control">if</span> <span class="ace_paren ace_lparen">(</span><span class="ace_identifier">n</span> <span class="ace_keyword ace_operator">==</span> <span class="ace_constant ace_numeric">5</span><span class="ace_paren ace_rparen">)</span> <span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment">//        cout &lt;&lt; READY;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_storage ace_type">char</span> <span class="ace_storage ace_modifier">const</span> <span class="ace_keyword ace_operator">*</span><span class="ace_identifier">pstar</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">info</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">c_str</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">write</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">STDOUT_FILENO</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_identifier">pstar</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_keyword ace_operator">sizeof</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">pstar</span><span class="ace_paren ace_rparen">))</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_support ace_function ace_C99 ace_c">memset</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">buf</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_constant ace_numeric">0</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_keyword ace_operator">sizeof</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">buf</span><span class="ace_paren ace_rparen">))</span><span class="ace_punctuation ace_operator">;</span>    <span class="ace_comment">// clear buffer container</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">read</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">STDIN_FILENO</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_keyword ace_operator">&amp;</span><span class="ace_identifier">buf</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_keyword ace_operator">sizeof</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">buf</span><span class="ace_paren ace_rparen">))</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_storage ace_type">char</span> <span class="ace_storage ace_modifier">const</span> <span class="ace_keyword ace_operator">*</span><span class="ace_identifier">pstar2</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">info2</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">c_str</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">write</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">STDOUT_FILENO</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_identifier">pstar2</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_keyword ace_operator">sizeof</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">pstar2</span><span class="ace_paren ace_rparen">))</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_support ace_function ace_C99 ace_c">memset</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">buf</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_constant ace_numeric">0</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_keyword ace_operator">sizeof</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">buf</span><span class="ace_paren ace_rparen">))</span><span class="ace_punctuation ace_operator">;</span>    <span class="ace_comment">// clear buffer container</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">read</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">STDIN_FILENO</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_keyword ace_operator">&amp;</span><span class="ace_identifier">buf</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_keyword ace_operator">sizeof</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">buf</span><span class="ace_paren ace_rparen">))</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_storage ace_type">char</span> <span class="ace_storage ace_modifier">const</span> <span class="ace_keyword ace_operator">*</span><span class="ace_identifier">pchar</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">num_2_char</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">READY</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">write</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">STDOUT_FILENO</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_identifier">pchar</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_keyword ace_operator">sizeof</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">pchar</span><span class="ace_paren ace_rparen">))</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment">//        write(STDOUT_FILENO, &amp;ready, sizeof(ready));</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_paren ace_rparen">}</span><span class="ace_keyword ace_control">else</span><span class="ace_paren ace_lparen">{</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment">//        cout &lt;&lt; 2000;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_storage ace_type">char</span> <span class="ace_storage ace_modifier">const</span> <span class="ace_keyword ace_operator">*</span><span class="ace_identifier">pchar</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">num_2_char</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">BREAK</span><span class="ace_paren ace_rparen">)</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">write</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">STDOUT_FILENO</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_identifier">pchar</span><span class="ace_punctuation ace_operator">,</span> <span class="ace_keyword ace_operator">sizeof</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">pchar</span><span class="ace_paren ace_rparen">))</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment">//        write(STDOUT_FILENO, &amp;error, sizeof(error));</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_paren ace_rparen">}</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_keyword ace_control">return</span> <span class="ace_identifier">array</span><span class="ace_punctuation ace_operator">;</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_paren ace_rparen">}</span>
</div></div></div></div><div class="cell markdown-cell"><h1>To be continued.</h1>
<h1>Still writing this report.</h1>
<h1>Hopefully I can finish it before Tuesday.</h1>
<h3>any update will be on github:</h3>
<p><a href="https://github.com/EasonJia9598/Pipe">https://github.com/EasonJia9598/Pipe</a><br>
Output<br>
<img src="resources/582167A0C186FAF0734F9BAF453DD3D8.jpg" alt="IMAGE" width="493" height="912"></p>
</div><div class="cell markdown-cell"><h1>Source Code:</h1>
<p>at /source_code folder</p>
</div><div class="cell markdown-cell"></div></div>
      <script>document.body.onkeyup = function(e) {
}</script>
    </body>
    </html>
  